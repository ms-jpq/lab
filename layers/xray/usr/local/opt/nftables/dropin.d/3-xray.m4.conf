# NL

# m4_ifelse(m5_assert([ENV_XRAY_CLIENT]), [1], [

define XRAY     = 8888
define XRAY_SOCK = 30001-30002

# udp . 51820 : $XRAY, udp . https : $XRAY
add element inet user hijack { tcp . https : $XRAY }
add element inet user internal_ports { tcp . $XRAY_SOCK, udp . $XRAY_SOCK }

table inet user {
  chain prerouting {
    # iifname @internal_ifs meta l4proto udp th dport https tproxy ip  to :8889 counter comment "xray proxy"
    # iifname @internal_ifs meta l4proto udp th dport https tproxy ip6 to :8889 counter comment "xray proxy"
  }

  chain forward {
    udp dport https counter reject with icmpx admin-prohibited comment "No HTTP/3"
  }
}

# ])
