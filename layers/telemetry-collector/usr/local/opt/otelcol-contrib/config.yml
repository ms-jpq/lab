# https://opentelemetry.io/docs/collector/configuration/
---
extensions:
  &cursor file_storage/journald:
    directory: /var/lib/local/otelcol-contrib
receivers:
  # https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/journaldreceiver
  &input journald:
    merge: true
    all: true
    convert_message_bytes: true
    retry_on_failure:
      enabled: true
    storage: *cursor
    # https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/pkg/stanza/docs/operators/README.md#what-operators-are-available
    operators:
      # https://grafana.com/docs/loki/latest/send-data/otel/#format-considerations
      - type: add
        field: resource.service.name
        value: journald
exporters:
  debug:
    verbosity: detailed
  &output otlphttp:
    endpoint: http://127.0.0.53:3100/otlp
service:
  extensions:
    - *cursor
  pipelines:
    logs:
      receivers:
        - *input
      exporters:
        - *output
