[Unit]
Description         = fs-alloc -- %S/local/%J/%I
StopWhenUnneeded    = yes
CollectMode         = inactive
RequiresMountsFor   = %S/local/%J
ConditionPathExists = !%S/local/%J/%I

PartOf              = machine.slice

[Service]
Slice               = machine.slice
Type                = oneshot
RemainAfterExit     = yes

Environment         = LIB=%S/local/%J
Environment         = ROOT=%S/local/%J/%I

ExecStart           = /usr/local/opt/%J/libexec/fs-alloc.sh ${LIB} ${ROOT}
