# https://github.com/open-telemetry/opentelemetry-helm-charts/blob/main/charts/opentelemetry-collector/values.yaml
---
apiVersion: helm.cattle.io/v1
kind: HelmChart
metadata:
  name: &chart opentelemetry-collector
  namespace: kube-system
spec:
  chart: *chart
  createNamespace: true
  repo: https://open-telemetry.github.io/opentelemetry-helm-charts
  targetNamespace: *chart
  valuesContent: |-
    mode: daemonset
    image:
      repository: ghcr.io/open-telemetry/opentelemetry-collector-releases/opentelemetry-collector-k8s
    presets:
      logsCollection:
        enabled: true
        includeCollectorLogs: true
      kubernetesAttributes:
        enabled: true
    config:
      extensions:
        &auth basicauth/client:
          client_auth:
            username: loki
            password: m5_assert([ENV_OTLP_PASSWORD])
      exporters:
        otlp:
          auth:
            authenticator: basicauth/client
          endpoint: m5_assert([ENV_OTLP_ENDPOINT])
      service:
        extensions:
          - healthcheckv2
          - *auth
        pipelines:
          logs:
            receivers:
              - filelog
            exporters:
              - otlp
