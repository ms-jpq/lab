---
services:
  anubis:
    image: ghcr.io/techarohq/anubis:latest
    labels:
      kompose.service.expose: reddit.${DOMAIN}
    environment:
      COOKIE_DOMAIN: ${DOMAIN}
      ED25519_PRIVATE_KEY_HEX:
      SERVE_ROBOTS_TXT: true
      TARGET: http://redlib:8080
    ports:
      - 8923

  redlib:
    image: quay.io/redlib/redlib:latest
    labels:
      kompose.service.group: &warp redlib
    environment:
      REDLIB_AUTOPLAY_VIDEOS: on
      REDLIB_DEFAULT_AUTOPLAY_VIDEOS: on
      REDLIB_DEFAULT_BLUR_NSFW: on
      REDLIB_DEFAULT_COMMENT_SORT: top
      REDLIB_DEFAULT_DISABLE_VISIT_REDDIT_CONFIRMATION: on
      REDLIB_DEFAULT_HIDE_HLS_NOTIFICATION: on
      REDLIB_DEFAULT_USE_HLS: on
      REDLIB_ENABLE_RSS: on
      REDLIB_FULL_URL: https://reddit.${DOMAIN}
      REDLIB_REMOVE_DEFAULT_FEEDS: on
      REDLIB_ROBOTS_DISABLE_INDEXING: on
    ports:
      - 8080
    volumes:
      - ./redlib.toml:/redlib.toml:ro

  warp:
    image: docker.io/caomingjun/warp:latest
    labels:
      kompose.service.group: *warp
    cap_add:
      - NET_ADMIN
    volumes:
      - data:/var/lib/cloudflare-warp

volumes:
  data:
