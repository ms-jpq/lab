---
services:
  perplexica-api:
    image: docker.io/itzcrazykns1337/perplexica-backend:main
    labels:
      kompose.controller.type: statefulset
      kompose.volume.type: hostPath
    environment:
      SEARXNG_API_URL: http://searxng.kompsed-searx.svc.cluster.local:8080
    ports:
      - 3001
    configs:
      - source: conf
        target: /home/perplexica/config.toml
    volumes:
      - /var/lib/local/perplexica:/home/perplexica/data

  perplexica-web:
    image: itzcrazykns1337/perplexica-frontend:main
    ports:
      - 3000

  perplexica-proxy:
    image: docker.io/nginx:latest
    labels:
      kompose.service.expose: perp.${DOMAIN}
    ports:
      - 80
    volumes:
      - ./proxy.nginx:/etc/nginx/conf.d/default.conf

configs:
  conf:
    file: ./config.toml
