---
x-k8s:
  - apiVersion: networking.k8s.io/v1
    kind: NetworkPolicy
    metadata:
      name: addn-policy
      namespace: "${COMPOSE_PROJECT_NAME}"
    spec:
      ingress:
        - from:
            - namespaceSelector:
                matchLabels:
                  kubernetes.io/metadata.name: kompsed-invidious

services:
  proxy:
    image: docker.io/nginx:latest
    labels:
      kompose.controller.type: statefulset
      kompose.volume.type: hostPath
    ports:
      - 1080
    configs:
      - source: conf
        target: /etc/nginx/nginx.conf
    volumes:
      - /run/haproxy:/run/haproxy:ro

configs:
  conf:
    file: ./proxy.nginx
